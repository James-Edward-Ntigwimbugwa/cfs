import logging
from {{package_name}}_accounts.models import *
from {{package_name}}_dto.accounts_dto import *
from {{package_name}}_dto.gas_dto import ManufacturerObject
from {{package_name}}_dto_builders.auth_dto_builder import AuthBuilder
from {{package_name}}_utils.cache_utils import get_cached_model_or_db
from {{package_name}}_vendor_management.models import Manufacturer
logger = logging.getLogger(__name__)

class AccountBuilder:
    @classmethod
    def get_profile_data(cls, id):
        query_set: Profile = get_cached_model_or_db(Profile, id)
        if not query_set:
            return None
        
        user_role = getattr(query_set.user, "user_role", None)

        return ProfileObject(
            id=query_set.primary_key,
            unique_id=query_set.unique_id,
            first_name=query_set.user.first_name,
            last_name=query_set.user.last_name,
            email=query_set.user.email,
            phone_number=query_set.phone_number,
            location=query_set.location,
            is_verified=query_set.is_verified,
            phone_verified=query_set.phone_verified,    
            is_active=query_set.is_active,
            account_type = query_set.account_type or None,
            created_at= query_set.created_at if query_set.created_at else None,
            role=AuthBuilder.get_role_data(user_role.role.unique_id) if user_role else None
        )

    @classmethod
    def get_manufacturer_data(cls, id):
        query_set: Manufacturer = get_cached_model_or_db(Manufacturer, id)

        if not query_set:
            return None
        return ManufacturerObject(
            id=query_set.primary_key,
            unique_id=query_set.unique_id,
            
            # user=cls.get_user_data(query_set.user.unique_id) if query_set.user else None,
            company_name=query_set.company_name,
            brand=query_set.brand,
            trading_name=query_set.trading_name,
            registration_number=query_set.registration_number,
            tin_number=query_set.tin_number,
            year_established=query_set.year_established,
            primary_email=query_set.primary_email,
            secondary_email=query_set.secondary_email,
            phone_number=query_set.phone_number,
            website=query_set.website,
            physical_address=query_set.physical_address,
            street=query_set.street,
            postal_code=query_set.postal_code,
            is_verified=query_set.is_verified,
            verified_at=query_set.verified_at,
            business_license=query_set.business_license,
            business_license_number=query_set.business_license_number,
            brela_certificate=query_set.brela_certificate,
            tin_certificate=query_set.tin_certificate,
            manufacturing_capacity=query_set.manufacturing_capacity,
            factory_location=query_set.factory_location,
            warehouse_location=query_set.warehouse_location,
            is_suspended=query_set.is_suspended,
            suspension_reason=query_set.suspension_reason,
            suspended_at=query_set.suspended_at,
            created_at=query_set.created_at,
            is_active=query_set.is_active,
            # created_by=cls.get_profile_data(query_set.created_by.unique_id) if query_set.created_by else None
        )
