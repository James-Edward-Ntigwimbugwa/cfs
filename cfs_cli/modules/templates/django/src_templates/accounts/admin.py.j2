from django.apps import apps
from django.contrib import admin

# Get the AppConfig for your app
app_config = apps.get_app_config('{{package_name}}_accounts')

# Get all models in the app
all_models = app_config.get_models()

for model in all_models:
    # Get all field names
    field_names = [field.name for field in model._meta.fields]

    # Prepare search fields (exclude related FK fields)
    search_field_names = [
        field.name
        for field in model._meta.fields
        if not field.many_to_one and not field.many_to_many  # Exclude FK and M2M
    ]

    # Dynamically create a ModelAdmin class
    class DynamicAdmin(admin.ModelAdmin):
        list_display = field_names
        list_filter = field_names
        search_fields = search_field_names

    # Register the model with the admin site
    try:
        admin.site.register(model, DynamicAdmin)
    except admin.sites.AlreadyRegistered:
        # Ignore if model is already registered
        pass